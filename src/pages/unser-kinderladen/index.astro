---
import HeroImage from "../../components/HeroImage/HeroImage.astro";
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";

const kinderladen = await getCollection("kinderladen");

const { title, titleimage, tab1, tab2, tab3, tab4 } =
  kinderladen[0].data.kinderladen;

const tabs = [tab1, tab2, tab3, tab4];
---

<Layout
  title={title ?? ""}
  instagram="https://www.instagram.com/kila_kaenguruh/"
>
  <HeroImage slot="hero" text={title ?? ""}>
    <img src={titleimage?.node.sourceUrl} alt={titleimage?.node.altText} />
  </HeroImage>

  <div class="navigation-buttons">
    {
      tabs.map((tab) => {
        if (!tab.show) {
          return null;
        }

        return (
          <button class="nav-button" data-section={tab.title}>
            {tab.title}
          </button>
        );
      })
    }
  </div>

  <div class="content-sections">
    {
      tabs.map((tab) => {
        if (!tab.show) {
          return null;
        }

        return (
          <section
            id={tab.title}
            class="content-section"
            set:html={tab.content}
          />
        );
      })
    }
  </div>
</Layout>

<style>
  .holli {
    width: 50%;
    margin: 0 auto;
    display: block;
  }

  .navigation-buttons {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin: 2rem 0;
    flex-wrap: wrap;
  }

  .nav-button {
    padding: 0.75rem 1.5rem;
    border: 2px solid #4a5568;
    border-radius: 0.5rem;
    background: transparent;
    color: #4a5568;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
  }

  .nav-button:hover {
    background: #4a5568;
    color: white;
  }

  .nav-button.active {
    background: #4a5568;
    color: white;
  }

  .content-section {
    display: none;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .content-section.active {
    display: block;
    opacity: 1;
  }

  .content-section :global(img) {
    width: 800px;
    max-width: 100%;
    border-radius: 8px;
    height: auto;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const buttons = [...document.querySelectorAll(".nav-button")];
    const sections = [...document.querySelectorAll(".content-section")];

    buttons?.[0]?.classList.add("active");
    sections?.[0]?.classList.add("active");

    buttons.forEach((button) => {
      button.addEventListener("click", () => {
        // Remove active class from all buttons and sections
        buttons.forEach((btn) => btn.classList.remove("active"));
        sections.forEach((section) => section.classList.remove("active"));

        // Add active class to clicked button and corresponding section
        button.classList.add("active");
        const sectionId = button.getAttribute("data-section");
        if (sectionId) {
          const section = document.getElementById(sectionId);
          if (section) {
            section.classList.add("active");
          }
        }

        // Update URL without page reload
        const newUrl = `${window.location.pathname}#${sectionId || ""}`;
        window.history.pushState({}, "", newUrl);
      });
    });

    // Handle initial load with hash in URL
    const hash = window.location.hash.slice(1);
    if (hash) {
      const button = document.querySelector(
        `[data-section="${hash}"]`
      ) as HTMLButtonElement;
      if (button) {
        button.click();
      }
    }
  });
</script>
